---
# ====================================================
# ServiceAccount - идентификатор для Job
# ====================================================
apiVersion: v1
kind: ServiceAccount
metadata:
  name: artds-init-sa
  labels:
    app: artds
    component: initialization
---
# ====================================================
# Role - набор разрешений в рамках namespace
# ====================================================
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: artds-init-role
  labels:
    app: artds
    component: initialization
rules:
  # Разрешение на чтение StatefulSet
  - apiGroups: ["apps"]
    resources: ["statefulsets"]
    verbs: ["get", "list"]

  # Разрешение на изменение (patch) StatefulSet
  # Используется для рестарта подов через аннотацию
  - apiGroups: ["apps"]
    resources: ["statefulsets"]
    verbs: ["patch"]

  # Опционально: разрешение на чтение подов
  # Может быть полезно для проверки статуса
  - apiGroups: [""]
    resources: ["pods"]
    verbs: ["get", "list"]
---
# ====================================================
# RoleBinding - связывает ServiceAccount с Role
# ====================================================
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: artds-init-rolebinding
  labels:
    app: artds
    component: initialization
subjects:
  # ServiceAccount, которому предоставляются права
  - kind: ServiceAccount
    name: artds-init-sa
    namespace: artldap
roleRef:
  # Role, права которой предоставляются
  kind: Role
  name: artds-init-role
  apiGroup: rbac.authorization.k8s.io

